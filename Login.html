<script>
const form = document.getElementById('loginForm');
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const msg = document.getElementById('loginMessage');
    msg.className = 'message'; msg.textContent = '';

    if (!username || username.length < 3) {
        msg.classList.add('error');
        msg.textContent = 'Username must be at least 3 characters';
        return;
    }
    if (!password || password.length < 3) {
        msg.classList.add('error');
        msg.textContent = 'Password must be at least 3 characters';
        return;
    }

    try {
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (!response.ok) {
            msg.classList.add('error');
            msg.textContent = data.error || 'Login failed';
            return;
        }

        // Store only the token for authenticated API calls
        localStorage.setItem('idi_token', data.token);

        msg.classList.add('success');
        msg.textContent = `Welcome ${data.fullName || data.username}`;

        setTimeout(() => { window.location.href = 'Account.html'; }, 500);
    } catch (err) {
        msg.classList.add('error');
        msg.textContent = 'Failed to connect to server';
    }
});
</script>
